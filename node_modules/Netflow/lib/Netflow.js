var dgram=require("dgram");
var events=require("events");
var sys=require('util');
var NetflowPacket=require("NetFlowPacket");

var Netflow=module.exports=function(){
     this.server = dgram.createSocket("udp4");
     events.EventEmitter.call(this);
     var eventContext = this;
     this.server.on("message", function (mesg, rinfo) {
      try{
        newPacket=new NetflowPacket(mesg);
        if ((newPacket.header.version)==9){
          for ( v9Flowset in newPacket.v9Flowsets){
              //insert code here to check if flowset is data or template
          }
        }
        this.emit.call(eventContext,"packet", newPacket);
       }
      catch(err){
        this.emit.call(eventContext,"error",err);
      }
    });
    this.server.on("listening", this.emit.bind(this,"listening"));
this.listen=function (port){
  this.server.bind(port);  
}
}
sys.inherits(Netflow, events.EventEmitter);
